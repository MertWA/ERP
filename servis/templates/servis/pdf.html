<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        @page { size: A4; margin: 1cm; }
        body { font-family: 'Helvetica', 'Arial', sans-serif; font-size: 12px; color: #333; }
        .header { border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
        .title { font-size: 24px; font-weight: bold; text-align: right; }
        .logo { max-height: 60px; }
        .info-table, .content-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .info-table td { vertical-align: top; width: 50%; }
        .content-table th { background: #eee; border: 1px solid #999; padding: 5px; text-align: left; }
        .content-table td { border: 1px solid #999; padding: 5px; }
        .label { font-weight: bold; color: #555; }
        .status-check { font-family: DejaVu Sans, sans-serif; } /* Tik işareti için */
        .signature-box { margin-top: 30px; border: 1px solid #ccc; height: 100px; width: 300px; float: right; text-align: center; }
        .signature-img { max-height: 80px; max-width: 100%; }
    </style>
</head>
<body>
    <div class="header">
        <table width="100%">
            <tr>
                <td>{% if logo_url %}<img src="{{ logo_url }}" class="logo">{% else %}LOGO{% endif %}</td>
                <td class="title">{{ L.title }}</td>
            </tr>
        </table>
    </div>

    <table class="info-table">
        <tr>
            <td>
                <div class="label">{{ L.customer }}:</div>
                <strong>{{ s.musteri }}</strong><br>
                {{ s.musteri.ekstra_bilgiler.Adres|default:"" }}
            </td>
            <td style="text-align: right;">
                <div class="label">{{ L.ticket_no }}: {{ s.fis_no }}</div>
                
                <div class="label">{{ L.date }}: {{ s.tamamlanma_tarihi|default:s.planlanan_tarih|date:"d.m.Y H:i" }}</div>
                
                <div class="label">{{ L.technician }}: {{ teknisyenler }}</div>
            </td>
        </tr>
    </table>

    <div class="label">{{ L.subject }}:</div>
    <div style="margin-bottom: 15px; border: 1px solid #eee; padding: 5px;">{{ s.konu }}</div>

    {% if urunler %}
    <div class="label">{{ L.products }}:</div>
    <table class="content-table">
        <thead><tr><th>Ürün</th><th>Seri No</th><th>Adet</th></tr></thead>
        <tbody>
            {% for u in urunler %}
            <tr><td>{{ u.urun.ad }}</td><td>{{ u.seri_no }}</td><td>{{ u.adet }}</td></tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <div class="label">{{ L.actions }}:</div>
    <table class="content-table">
        <thead><tr><th width="80%">İşlem</th><th width="20%">Durum</th></tr></thead>
        <tbody>
            {% for islem in islemler %}
            <tr>
                <td>{{ islem.aciklama }}</td>
                <td>{% if islem.tamamlandi %}<span class="status-check">☑</span> Tamam{% else %}<span class="status-check">☐</span> ---{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if s.aciklama %}
    <div class="label">{{ L.notes }}:</div>
    <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 20px;">
        {{ s.aciklama|safe }}
    </div>
    {% endif %}

    {% if s.musteri_imzasi %}
    <div class="signature-box">
        <div style="border-bottom: 1px solid #ccc; background: #eee;">{{ L.signature }}</div>
        <img src="{{ s.musteri_imzasi }}" class="signature-img">
        
        {% if s.imza_atan_kisi %}
        <div style="font-size:10px; margin-top:5px; font-weight:bold;">{{ s.imza_atan_kisi }}</div>
        {% endif %}
        
    </div>
    {% endif %}
</body>
</html>